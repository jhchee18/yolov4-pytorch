import os
import numpy as np
from PIL import Image

label_directory = ".\dataset\dataset_leaf_and_dbm/test_label"
image_directory = ".\dataset\dataset_leaf_and_dbm/test"


for filename in os.listdir(label_directory):

    f = os.path.join(label_directory, filename)
    file = open(f, "r")
    im = Image.open(image_directory + '/' + filename[:-4] + '.jpg')
    imw, imh = im.size

    replacement = ""

    for line in file:
        changes = ""
        blocks = line.split()
        xmin, ymin, xmax, ymax = float(blocks[1]), float(blocks[2]), float(blocks[3]), float(blocks[4])
        centerh = ((ymin + ymax)/2)/imh
        centerw = ((xmin + xmax)/2)/imw
        bboxh = (ymax - ymin)/imh
        bboxw = (xmax - xmin)/imw
        changes = blocks[0] + " " + str(centerw) + " " + str(centerh) + " " + str(bboxw) + " " + str(bboxh) + "\n"
        replacement = replacement + changes

    file.close()
    fout = open(f, "w")
    fout.write(replacement)
    fout.close()

print("done")


'''
                centerw, bboxw = inputline[1] * imw, inputline[3] * imw
                centerh, bboxh = inputline[2] * imh, inputline[4] * imh
                # 中心宽高相对坐标转换成左上右下绝对坐标
                xmin = int(centerw - bboxw / 2)
                xmax = int(centerw + bboxw / 2)
                ymin = int(centerh - bboxh / 2)
                ymax = int(centerh + bboxh / 2)

                imw, imh = im.size

                centerh = ((ymin + ymax)/2)/imh
                centerw = ((xmin + xmax)/2)/imw
                bboxh = (ymax - ymin)/imh
                bboxw = (xmax - xmin)/imw

                result = [centerw, centerh, bboxw, bboxh]
                '''